<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
</HEAD>
<BODY>

<FONT SIZE=6>Упражнение 6. Организация циклических вычислений</FONT>
<hr>
<P>Разработаем программу, которая будет рисовать расходящиеся из центра 
формы случайные разноцветные лучи. На форме имеется кнопка СТАРТ при нажатии
на которую программа должна приступить к рисованию линий. При этом надпись
на кнопке должна замениться на СТОП. Повторное нажатие кнопки вызывает
остановку рисования линии.</P>

<P><b>Шаг 1</b>. Создайте новое приложение <b>File > New Application</b> и сохраните его в созданном для данного
приложения подкаталоге <b>Cikl</b> своего каталога. При записи модулю формы присвойте имя <b>MainForm</b>,
а проекту - <b>Cikl</b>.</P>

<P><b>Шаг 2</b>. Настройте свойства формы:
<TABLE>
 <TR><TD><i>Свойство</i></TD><TD><i>Значение</i></TD></TR>
 <TR><TD><b>Caption</b></TD><TD>Рисование линий</TD></TR>
 <TR><TD><b>Position</b></TD><TD>ScreenCenter</TD></TR>
 <TR><TD><b>WindowState</b></TD><TD>wsMaximized</TD></TR>
</TABLE>
Запустите задание и проверьте результат.<br><br>

<b>Шаг 3</b>. Поместите на форму кнопку <b>Button</b> и присвойте ее свойствам следующие значения
<TABLE>
 <TR><TD><i>Свойство</i></TD><TD><i>Значение</i></TD></TR>
 <TR><TD><b>Caption</b></TD><TD>СТАРТ</TD></TR>
 <TR><TD><b>Name</b></TD><TD>BStart</TD></TR>
</TABLE>

<b>Шаг 4</b>. В секции реализации модуля формы после строки {$R *.DFM} введите следующий текст:
<PRE><FONT COLOR=BLUE>
<b>const</b> Ok : Boolean = False;

<b>procedure</b> Step;
<b>var</b> r,g,b,w,h,x,y,xc,yc : integer;  CNV : TCanvas;
<b>Begin</b>
  w:=Form1.ClientWidth;     <FONT COLOR=RED>//ширина формы</FONT>
  h:=Form1.ClientHeight;    <FONT COLOR=RED>//высота формы</FONT>
  CNV:=Form1.Canvas;
  x:=Random(w); y:=Random(h); <FONT COLOR=RED>//случайные координаты и цвет</FONT>
  r:=55+Random(201);  g:=55+Random(201);  b:=55+Random(201);
  xc:=w div 2;              <FONT COLOR=RED>//координаты центра формы</FONT>
  yc:=h div 2; 
  <b>with</b> CNV <b>do</b>
   <b>begin</b> Pen.Color:=RGB(r,g,b);
    MoveTo(xc,yc);
    LineTo(x,y);
   <b>end</b>;
  Application.ProcessMessages; <FONT COLOR=RED>//обработчик событий</FONT>
<b>End</b>;

<b>procedure</b> Start;
<b>Begin</b>
  <b>while</b> Ok <b>do</b> Step;
<b>End</b>;
</FONT></PRE>

Вызов метода <b>Application.ProcessMessages</b> прерывает управление программы
и передает управление ядру операционной системы. Обработчик событий операционной
системы обрабатывает очередь сообщений (нажатие кнопок, прерывания и т.п.) и
возвращает управление вызывающей программе.<br><br>

<b>Шаг 5</b>. Щелкните на кнопке BStart и создайте обработчик события <b>OnClick</b>:
<PRE><FONT COLOR=BLUE>
<b>procedure</b> TForm1.BStartClick(Sender: TObject);
<b>begin</b>
  <b>if</b> Ok <b>then</b> <FONT COLOR=RED>//если идет процесс рисования</FONT>
   <b>begin</b> Ok:=False;
     BStart.Caption:='СТАРТ';
   <b>end  else</b> <FONT COLOR=RED>//если процесса рисования нет</FONT>
   <b>begin</b> Ok:=True;
     BStart.Caption:='СТОП';
     Start;
   <b>end;
end</b>;
</FONT></PRE>

<b>Шаг 6</b>. При запуске программы константе <b>Ok</b> присваивается значение <b>False</b>.
После нажатия кнопки СТАРТ константа <b>Ok</b> принимает значение <b>True</b>, название
кнопки меняется на СТОП и запускается процедура <b>Start</b>. Процедура <b>Start</b>
включает цикл с предусловием, который будет выполняться пока <b>Ok</b>=<b>True</b>.
На каждом шаге вызывается процедура <b>Step</b>, которая рисует случайный луч
случайного цвета, исходящий из центра формы. После рисования луча
вызывается системный обработчик событий <b>Application.ProcessMessages</b>. 
Если обработчик исключить, то программа будет выполняться вечно.<br> 
Если при выполнении процедуры <b>Start</b> еще раз нажать кнопку на форме, то
после рисования очередного луча и при обращении к системному обработчику
<b>Application.ProcessMessages</b> произойдет обработка события <b>OnClick</b>
кнопки. При этом значение <b>Ok</b> изменится на <b>False</b>, а название кнопки
сменится на СТАРТ. После возвращения в процедуру <b>Start</b> цикл закончится
и рисование линий прекратимться.<br><br>  

<b>Шаг 7</b>. Запустите программу и посмотрите результат. Модифицируйте программу, 
заставив точку схождения лучей двигаться по эллипсу.

<hr>
<CENTER><FONT FACE="Wingdings" size=6>&#70;</FONT>
<a href="Cicl.exe">Пример выполняемой программы</a>
<FONT FACE="Wingdings" size=6>&#69;</FONT></CENTER>
<hr>
<img SRC="../../PIC/zadan.gif" ALIGN=LEFT>
 <FONT SIZE=6><u><i>Задание для самостоятельного выполнения</i></u></FONT><br>
Разработать программу, которая по нажатию кнопки начинает рисовать, а по повторному нажатию 
прекращает рисовать различные геометрические объекты в случайном 
положении случайного размера и цвета: 
<OL>
  <LI>точки;
  <LI>отрезки прямых линий;
  <LI>прямоугольники;
  <LI>эллипсы;
  <LI>звездочки;
  <LI>окружности;
  <LI>треугольники;
  <LI>крестики;
  <LI>символы текста;
  <LI>ромбики;
</OL>
<hr>
<a href="../upr.htm"><i>вернуться к оглавлению</i></a><br>  

</BODY>
</HTML>
